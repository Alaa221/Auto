<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Showroom</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f8f9fa; font-family:"Cairo",sans-serif; }
    /* ===== الهيدر (أكبر أفقيًا) ===== */
    .header {
      width:100%;
      height:360px; /* كبرنا الهيدر */
      background: url("/static/header.jpg") center/cover no-repeat;
      border-bottom-left-radius:18px;
      border-bottom-right-radius:18px;
    }

    /* ===== صندوق اللينكات + البحث تحت الصورة ===== */
    .toolbar {
      width:90%;
      max-width:1200px;
      margin: 18px auto;
      background: #fff;
      padding: 14px 18px;
      border-radius:12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap:10px;
      align-items: center;
    }

    /* اللينكات في السطر الأول (موجودة في المركز) */
    .links-row {
      width:100%;
      text-align:center;
    }
    .links-row a {
      display:inline-block;
      margin: 0 14px;
      color:#333;
      font-weight:700;
      text-decoration:none;
      font-size:18px;
      padding:6px 12px;
      border-radius:8px;
      transition: background .18s, color .18s, transform .12s;
    }
    .links-row a:hover { background:#f1f1f1; transform:translateY(-2px); color:#dc3545; }
    .links-row a.active { background:#dc3545; color:#fff; }

    /* مربع البحث في صف منفصل تحت اللينكات (منسق وصغير) */
    .search-row {
      width:100%;
      display:flex;
      justify-content:center;
    }
    .search-row form {
      display:flex;
      gap:6px;
      align-items:center;
    }
    .search-row input[type="text"]{
      width:260px;
      padding:8px 12px;
      border-radius:24px 6px 6px 24px;
      border:1px solid #ddd;
      outline:none;
    }
    .search-row button {
      padding:8px 14px;
      border-radius:6px 24px 24px 6px;
      border: none;
      background:#dc3545;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    .search-row button:hover { background:#a71d2a; }

    /* ===== نموذج الإضافة (لم تلمسناه) ===== */
    .form-section { background:#fff; padding:22px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.04); margin:18px auto; max-width:1100px; }

    /* ===== الكروت مع انيميشن عند الوقوف ===== */
    .cars-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:20px; width:90%; max-width:1200px; margin: 18px auto 60px auto; }
    .car-card { border-radius:12px; overflow:hidden; background:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.06); transition: transform .25s ease, box-shadow .25s ease; }
    .car-card:hover { transform: translateY(-8px); box-shadow:0 14px 36px rgba(0,0,0,0.12); }
    .car-card img { width:100%; height:180px; object-fit:cover; display:block; }
    .car-body { padding:14px; text-align:right; }
    .car-body h5 { margin:0 0 6px 0; font-weight:700; }
    .car-body p { margin:4px 0; color:#555; font-size:14px; }

    /* الأزرار */
    .btn-small { padding:7px 12px; border-radius:10px; font-weight:700; }
    .btn-reserve { background:#28a745; color:#fff; border:none; }
    .btn-cancel { background:#ffc107; color:#111; border:none; }
    .btn-delete { background:#dc3545; color:#fff; border:none; }

    /* لإخفاء الكروت عند تطبيق فلتر */
    .hidden { display:none !important; }
  </style>
</head>
<body>

  <!-- الهيدر -->
  <div class="header"></div>

  <!-- صندوق اللينكات والبحث تحت الصورة -->
  <div class="toolbar" role="region" aria-label="Toolbar">
    <!-- اللينكات مركزين -->
    <div class="links-row" aria-hidden="false">
      <a href="#" id="link-all" class="active" onclick="showAll(); return false;">كل العربيات</a>
      <a href="#" id="link-reserved" onclick="showReserved(); return false;">العربيات المحجوزة</a>
    </div>

    <!-- مربع البحث في صف تحت اللينكات -->
    <div class="search-row" role="search">
      <form action="{{ url_for('index') }}" method="get" novalidate>
        <input type="text" name="search" placeholder="🔍 ابحث عن سيارة..." value="{{ search_query or '' }}">
        <button type="submit">بحث</button>
      </form>
    </div>
  </div>

  <!-- نموذج الإضافة (كما كان) -->
  <div class="form-section">
    <form method="post" enctype="multipart/form-data" action="{{ url_for('index') }}">
      <div class="row g-3">
        <div class="col-md-6">
          <input required name="name" class="form-control" placeholder="اسم السيارة">
        </div>
        <div class="col-md-6">
          <input required name="color" class="form-control" placeholder="اللون">
        </div>
        <div class="col-md-6">
          <input required name="condition" class="form-control" placeholder="الحالة">
        </div>
        <div class="col-md-6">
          <input name="image" type="file" class="form-control">
        </div>
        <div class="col-12">
          <textarea name="description" class="form-control" rows="3" placeholder="الوصف"></textarea>
        </div>
        <div class="col-12 text-center">
          <button class="btn btn-danger btn-lg px-5" type="submit">إضافة السيارة</button>
        </div>
      </div>
    </form>
  </div>

  <!-- شبكة الكروت -->
  <div class="cars-grid" id="carsGrid">
    {% for car in cars %}
    <!-- أضفنا data-reserved حتى نعمل فلتر client-side بدون تغيير الباك-إند -->
    <div class="car-card" data-reserved="{{ '1' if car.reserved else '0' }}">
      {% if car.image %}
        <img src="{{ car.image }}" alt="{{ car.name }}">
      {% else %}
        <img src="/static/noimage.png" alt="no image">
      {% endif %}
      <div class="car-body">
        <h5>{{ car.name }}</h5>
        <p><strong>الحالة:</strong> {{ car.condition }}</p>
        <p><strong>اللون:</strong> {{ car.color }}</p>
        <p>{{ car.description }}</p>

        <div class="d-flex justify-content-between mt-2">
          {% if not car.reserved %}
            <a href="{{ url_for('reserve', car_id=car.id) }}" class="btn btn-reserve btn-small">حجز</a>
          {% else %}
            <a href="{{ url_for('reserve', car_id=car.id) }}" class="btn btn-cancel btn-small">إلغاء الحجز</a>
          {% endif %}
          <a href="{{ url_for('delete', car_id=car.id) }}" class="btn btn-delete btn-small">حذف</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <script>
    // فلتر بسيط client-side لعرض المحجوزة أو كل العربيات
    const linkAll = document.getElementById('link-all');
    const linkReserved = document.getElementById('link-reserved');

    function showAll() {
      toggleActive(linkAll);
      document.querySelectorAll('#carsGrid .car-card').forEach(card => {
        card.classList.remove('hidden');
      });
    }

    function showReserved() {
      toggleActive(linkReserved);
      document.querySelectorAll('#carsGrid .car-card').forEach(card => {
        const reserved = card.getAttribute('data-reserved');
        if (reserved === '1') card.classList.remove('hidden');
        else card.classList.add('hidden');
      });
    }

    function toggleActive(activeEl) {
      [linkAll, linkReserved].forEach(el => el.classList.remove('active'));
      activeEl.classList.add('active');
    }

    // لو الصفحة جت مع query param يحاول يطبق فلتر تلقائي (اختياري)
    (function applyQueryFilter(){
      const params = new URLSearchParams(window.location.search);
      if (params.get('filter') === 'reserved') {
        showReserved();
      } else {
        showAll();
      }
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
